<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Bingo Host</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>ğŸ± Bingo Host</h1>
<p id="invite">Verbinden...</p>

<button onclick="draw()">ğŸ² Trek nummer</button>
<button onclick="resetGame()">ğŸ”„ Reset</button>

<h2 id="number">-</h2>

<h3>ğŸ† Winnaars</h3>
<ul id="winners"></ul>

<script>
const peer = new Peer();
let connections = [];
let drawnNumbers = [];

peer.on("open", id => {
  document.getElementById("invite").innerHTML =
    `Invite link:<br><b>${location.origin}/player.html?host=${id}</b>`;
});

peer.on("connection", conn => {
  connections.push(conn);

  conn.on("data", msg => {
    if (msg.type === "bingo") {
      const li = document.createElement("li");
      li.textContent = "ğŸ† " + msg.name + " heeft BINGO!";
      document.getElementById("winners").appendChild(li);
    }
  });
});

function draw() {
  if (drawnNumbers.length >= 75) {
    alert("Alle nummers zijn al getrokken!");
    return;
  }

  let n;
  do {
    n = Math.floor(Math.random() * 75) + 1;
  } while (drawnNumbers.includes(n));

  drawnNumbers.push(n);
  document.getElementById("number").innerText = n;

  connections.forEach(c => {
    c.send({ type: "number", value: n });
  });
}

function resetGame() {
  drawnNumbers = [];
  document.getElementById("number").innerText = "-";
  document.getElementById("winners").innerHTML = "";

  connections.forEach(c => {
    c.send({ type: "reset" });
  });
}
</script>

</body>
</html>
